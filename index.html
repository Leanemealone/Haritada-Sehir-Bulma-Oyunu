<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SÃ¼per Gezgin: TÃ¼rkiye Turu ğŸŒ</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

    <style>
        :root { --ana-renk: #4caf50; --turuncu: #f57c00; --mavi: #00bcd4; }
        body { margin: 0; font-family: 'Comic Sans MS', cursive; overflow: hidden; background: #e0f7fa; }

        /* Yan Ã‡evirme UyarÄ±sÄ± */
        #rotate-warning {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #2c3e50; color: white; z-index: 1000;
            flex-direction: column; justify-content: center; align-items: center; text-align: center;
        }

        @media screen and (orientation: portrait) {
            #rotate-warning { display: flex; }
            #game-area, #login-screen { display: none; }
        }

        /* GiriÅŸ EkranÄ± ve Skor Tablosu */
        #login-screen { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; background: #ffeb3b; padding: 20px; }
        .login-card {
            background: white; padding: 20px; border-radius: 30px; 
            box-shadow: 0 15px 30px rgba(0,0,0,0.1); text-align: center; width: 380px; max-height: 95vh;
        }
        
        #leaderboard { 
            margin-top: 15px; background: #fff3e0; border-radius: 15px; padding: 10px; 
            max-height: 200px; overflow-y: auto;
        }
        .lb-row { display: flex; justify-content: space-between; padding: 8px 12px; border-bottom: 1px solid #ffe0b2; font-size: 0.9rem; }

        input { padding: 10px; width: 80%; border: 2px solid var(--turuncu); border-radius: 10px; font-size: 1rem; }
        button { padding: 12px 25px; background: var(--ana-renk); color: white; border: none; border-radius: 12px; cursor: pointer; font-weight: bold; margin-top: 10px; }

        /* Oyun AlanÄ± */
        #game-area { display: none; flex-direction: column; height: 100vh; }
        #header { height: 15%; background: var(--ana-renk); color: white; display: flex; justify-content: space-around; align-items: center; font-size: 1.2rem; }
        #target-city { background: white; color: #d32f2f; padding: 5px 20px; border-radius: 25px; font-weight: bold; }

        #map-container { flex: 1; position: relative; display: flex; justify-content: center; align-items: center; overflow: hidden; }
        svg { width: 95%; height: 95%; max-height: 80vh; }
        
        path { fill: #ffffff; stroke: #455a64; stroke-width: 0.6; transition: 0.2s; cursor: pointer; }
        path:hover { fill: #fff176 !important; }
        .dogru { fill: #4caf50 !important; }
        .yanlis { fill: #f44336 !important; }

        #feedback { position: absolute; top: 5%; left: 50%; transform: translateX(-50%); font-size: 2rem; font-weight: bold; z-index: 100; pointer-events: none; }
    </style>
</head>
<body>

    <div id="rotate-warning">
        <h1>ğŸ“± LÃ¼tfen telefonunuzu yan Ã§evirin!</h1>
        <p>HaritayÄ± gÃ¶rebilmek iÃ§in ekranÄ±n yan olmasÄ± gerekiyor.</p>
    </div>

    <div id="login-screen">
        <div class="login-card">
            <h2 style="color: var(--turuncu); margin: 5px 0;">SÃ¼per Gezgin ğŸŒ</h2>
            <input type="text" id="student-pass" placeholder="Åifreni Yaz">
            <button onclick="loginCheck()">OYUNA BAÅLA ğŸš€</button>
            
            <div id="leaderboard">
                <h3 style="margin: 5px 0; font-size: 1rem;">ğŸ† En YÃ¼ksek 20 Skor</h3>
                <div id="lb-list">YÃ¼kleniyor...</div>
            </div>
        </div>
    </div>

    <div id="game-area">
        <div id="header">
            <div>ğŸ“ Bul: <span id="target-city">---</span></div>
            <div>â±ï¸ <span id="timer">60</span></div>
            <div>ğŸ† <span id="score">0</span></div>
        </div>
        <div id="map-container">
            <div id="feedback"></div>
            <svg id="turkiye-svg" viewBox="0 0 1100 500" xmlns="http://www.w3.org/2000/svg"></svg>
        </div>
    </div>

    <audio id="snd-success" src="success.mp3"></audio>
    <audio id="snd-error" src="error.mp3"></audio>

    <script>
        // FIREBASE AYARLARI
        const firebaseConfig = {
            apiKey: "AIzaSyDYEMEciQh-5wEYXgRChyX9PA9FCcehVew",
            authDomain: "haritada-sehir-bulma-oyunu.firebaseapp.com",
            projectId: "haritada-sehir-bulma-oyunu",
            storageBucket: "haritada-sehir-bulma-oyunu.firebasestorage.app",
            messagingSenderId: "212809269056",
            appId: "1:212809269056:web:d8c7e6e4e6c22e97c344a5"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        let aktifOgrenci = null;
        let puan = 0;
        let sure = 60;
        let sorulanSehir = "";
        let sehirListesi = [];
        let haritaYuklendi = false;

        // SKORLARI YÃœKLE (TOP 20)
        async function skorlariYukle() {
            const lbList = document.getElementById('lb-list');
            try {
                const snapshot = await db.collection("ogrenciler").orderBy("puan", "desc").limit(20).get();
                lbList.innerHTML = "";
                let sira = 1;
                snapshot.forEach(doc => {
                    const d = doc.data();
                    lbList.innerHTML += `<div class="lb-row"><span>${sira}. ${d.ad}</span> <b>${d.puan}</b></div>`;
                    sira++;
                });
            } catch (e) { lbList.innerHTML = "Skorlar alÄ±namadÄ±."; }
        }

        // HARÄ°TAYI YÃœKLE
        async function haritayiHazirla() {
            try {
                // GitHub Pages uyumu iÃ§in ./tr.json kullanÄ±ldÄ±
                const res = await fetch('./tr.json');
                if(!res.ok) throw new Error("JSON bulunamadÄ±");
                const data = await res.json();
                const svg = document.getElementById('turkiye-svg');

                data.forEach(sehir => {
                    sehirListesi.push(sehir.name);
                    const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
                    path.setAttribute("d", sehir.path);
                    path.setAttribute("id", sehir.name);
                    path.addEventListener('click', () => sehirTiklandi(path));
                    svg.appendChild(path);
                });
                haritaYuklendi = true;
                console.log("Harita hazÄ±r!");
            } catch (err) {
                console.error("Hata:", err);
                alert("Harita dosyasÄ± (tr.json) yÃ¼klenemedi!");
            }
        }

        // GÄ°RÄ°Å
        async function loginCheck() {
            if(!haritaYuklendi) {
                alert("Harita henÃ¼z yÃ¼kleniyor, lÃ¼tfen bekleyin...");
                return;
            }
            const sifre = document.getElementById('student-pass').value;
            if(!sifre) return;

            const doc = await db.collection("ogrenciler").doc(sifre).get();
            if (doc.exists) {
                aktifOgrenci = { id: sifre, ...doc.data() };
                document.getElementById('login-screen').style.display = 'none';
                document.getElementById('game-area').style.display = 'flex';
                oyunuBaslat();
            } else { alert("Åifre hatalÄ±! LÃ¼tfen Ã¶ÄŸretmeninize danÄ±ÅŸÄ±n."); }
        }

        function oyunuBaslat() {
            yeniSehirSor();
            const sayac = setInterval(() => {
                sure--;
                document.getElementById('timer').innerText = sure;
                if (sure <= 0) { clearInterval(sayac); oyunBitti(); }
            }, 1000);
        }

        function yeniSehirSor() {
            if(sehirListesi.length === 0) return;
            sorulanSehir = sehirListesi[Math.floor(Math.random() * sehirListesi.length)];
            document.getElementById('target-city').innerText = sorulanSehir.toUpperCase();
        }

        function sehirTiklandi(el) {
            if (sure <= 0) return;
            const fb = document.getElementById('feedback');
            
            if (el.id === sorulanSehir) {
                puan += 10;
                document.getElementById('score').innerText = puan;
                fb.innerText = "Aferin doÄŸru cevapladÄ±n! âœ…"; fb.style.color = "#4caf50";
                document.getElementById('snd-success').play().catch(()=>{});
                el.classList.add('dogru');
                setTimeout(() => { el.classList.remove('dogru'); fb.innerText = ""; yeniSehirSor(); }, 800);
            } else {
                fb.innerText = "ÃœzgÃ¼nÃ¼m tekrar dene! âŒ"; fb.style.color = "#f44336";
                document.getElementById('snd-error').play().catch(()=>{});
                el.classList.add('yanlis');
                setTimeout(() => { el.classList.remove('yanlis'); fb.innerText = ""; }, 600);
            }
        }

        function oyunBitti() {
            const rekorPuan = Math.max(puan, aktifOgrenci.puan || 0);
            db.collection("ogrenciler").doc(aktifOgrenci.id).update({ puan: rekorPuan })
            .then(() => {
                alert("SÃ¼re doldu! Skorun: " + puan);
                location.reload();
            });
        }

        window.onload = () => {
            haritayiHazirla();
            skorlariYukle();
        };
    </script>
</body>
</html>
