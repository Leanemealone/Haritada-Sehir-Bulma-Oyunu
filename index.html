<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SÃ¼per Gezgin: TÃ¼rkiye Turu ğŸŒ</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <style>
        :root { --ana-renk: #4caf50; --turuncu: #f57c00; }
        body { margin: 0; font-family: 'Comic Sans MS', cursive; overflow: hidden; background: #e0f7fa; }
        
        #rotate-warning { 
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: #2c3e50; color: white; z-index: 2000; 
            flex-direction: column; justify-content: center; align-items: center; text-align: center; 
        }

        @media screen and (orientation: portrait) {
            #rotate-warning { display: flex; }
            #game-area, #login-screen { display: none; }
        }

        #login-screen { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; background: #ffeb3b; }
        .login-card { background: white; padding: 25px; border-radius: 30px; box-shadow: 0 15px 30px rgba(0,0,0,0.1); text-align: center; width: 350px; }
        
        #game-area { display: none; flex-direction: column; height: 100vh; }
        #header { height: 15%; background: var(--ana-renk); color: white; display: flex; justify-content: space-around; align-items: center; font-size: 1.2rem; }
        #target-city { background: white; color: #d32f2f; padding: 5px 20px; border-radius: 25px; font-weight: bold; }
        
        #map-container { flex: 1; position: relative; display: flex; justify-content: center; align-items: center; background: #e0f7fa; padding: 10px; }
        svg { width: 100%; height: 100%; filter: drop-shadow(0 4px 8px rgba(0,0,0,0.1)); }
        
        path { fill: #ffffff; stroke: #455a64; stroke-width: 0.8; transition: 0.2s; cursor: pointer; }
        path:hover { fill: #fff176 !important; stroke-width: 2; }
        .dogru { fill: #4caf50 !important; }
        .yanlis { fill: #f44336 !important; }

        #feedback { position: absolute; top: 10%; left: 50%; transform: translateX(-50%); font-size: 2.2rem; font-weight: bold; z-index: 100; pointer-events: none; text-shadow: 2px 2px 4px rgba(0,0,0,0.1); }
        
        #leaderboard { margin-top: 15px; background: #fff3e0; border-radius: 15px; padding: 10px; max-height: 180px; overflow-y: auto; }
        .lb-row { display: flex; justify-content: space-between; padding: 5px; border-bottom: 1px solid #ffe0b2; font-size: 0.85rem; }
    </style>
</head>
<body>

    <div id="rotate-warning">
        <h1>ğŸ“± Telefonu Yan Ã‡evir!</h1>
        <p>HaritayÄ± gÃ¶rebilmek iÃ§in ekranÄ±n yan olmasÄ± gerekiyor.</p>
    </div>

    <div id="login-screen">
        <div class="login-card">
            <h2 style="color: var(--turuncu);">Gezgin GiriÅŸi ğŸŒ</h2>
            <input type="text" id="student-pass" placeholder="Åifren" style="padding:12px; border-radius:10px; border:2px solid var(--turuncu); width:80%; outline:none;">
            <br>
            <button onclick="loginCheck()" style="margin-top:15px; padding:12px 30px; background:var(--ana-renk); color:white; border:none; border-radius:15px; font-weight:bold; cursor:pointer;">BAÅLA! ğŸš€</button>
            
            <div id="leaderboard">
                <h4 style="margin:5px 0;">ğŸ† En YÃ¼ksek 20 Skor</h4>
                <div id="lb-list">YÃ¼kleniyor...</div>
            </div>
        </div>
    </div>

    <div id="game-area">
        <div id="header">
            <div>ğŸ“ Bul: <span id="target-city">---</span></div>
            <div>â±ï¸ <span id="timer">60</span></div>
            <div>ğŸ† <span id="score">0</span></div>
        </div>
        <div id="map-container">
            <div id="feedback"></div>
            <svg id="turkiye-svg" viewBox="0 0 1010 440" xmlns="http://www.w3.org/2000/svg">
                </svg>
        </div>
    </div>

    <audio id="snd-success" src="success.mp3"></audio>
    <audio id="snd-error" src="error.mp3"></audio>

    <script>
        // FIREBASE AYARLARI
        const firebaseConfig = {
            apiKey: "AIzaSyDYEMEciQh-5wEYXgRChyX9PA9FCcehVew",
            authDomain: "haritada-sehir-bulma-oyunu.firebaseapp.com",
            projectId: "haritada-sehir-bulma-oyunu",
            storageBucket: "haritada-sehir-bulma-oyunu.firebasestorage.app",
            messagingSenderId: "212809269056",
            appId: "1:212809269056:web:d8c7e6e4e6c22e97c344a5"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // Skoru Ã§ekme hatasÄ±nÄ± engellemek iÃ§in yerel depolama ayarÄ±
        db.settings({ cacheSizeBytes: firebase.firestore.CACHE_SIZE_UNLIMITED });

        let aktifOgrenci = null;
        let puan = 0;
        let sure = 60;
        let sorulanSehir = "";
        let sehirListesi = [];

        // 1. SKORLARI YÃœKLE
        async function skorlariYukle() {
            try {
                const snapshot = await db.collection("ogrenciler").orderBy("puan", "desc").limit(20).get();
                const lbList = document.getElementById('lb-list');
                lbList.innerHTML = "";
                let sira = 1;
                snapshot.forEach(doc => {
                    lbList.innerHTML += `<div class="lb-row"><span>${sira}. ${doc.data().ad}</span><b>${doc.data().puan}</b></div>`;
                    sira++;
                });
            } catch (e) { console.log("Skorlar ÅŸu an alÄ±namÄ±yor."); }
        }

        // 2. GÄ°RÄ°Å
        async function loginCheck() {
            const sifre = document.getElementById('student-pass').value;
            if(!sifre) return;
            try {
                const doc = await db.collection("ogrenciler").doc(sifre).get();
                if (doc.exists) {
                    aktifOgrenci = { id: sifre, ...doc.data() };
                    document.getElementById('login-screen').style.display = 'none';
                    document.getElementById('game-area').style.display = 'flex';
                    oyunuBaslat();
                } else { alert("Åifre hatalÄ±! ğŸ§"); }
            } catch (e) { alert("BaÄŸlantÄ± sorunu yaÅŸanÄ±yor."); }
        }

        // 3. OYUN AKIÅI
        function oyunuBaslat() {
            // SVG iÃ§indeki pathleri listeye al ve tÄ±klama dinleyicisi ekle
            const paths = document.querySelectorAll('#turkiye-svg path');
            paths.forEach(p => {
                if(p.id) {
                    sehirListesi.push(p.id);
                    p.addEventListener('click', () => sehirTiklandi(p));
                }
            });
            yeniSehirSor();
            const sayac = setInterval(() => {
                sure--;
                document.getElementById('timer').innerText = sure;
                if (sure <= 0) { clearInterval(sayac); oyunBitti(); }
            }, 1000);
        }

        function yeniSehirSor() {
            if(sehirListesi.length === 0) return;
            sorulanSehir = sehirListesi[Math.floor(Math.random() * sehirListesi.length)];
            document.getElementById('target-city').innerText = sorulanSehir.toUpperCase();
        }

        function sehirTiklandi(el) {
            const fb = document.getElementById('feedback');
            if (el.id === sorulanSehir) {
                puan += 10;
                document.getElementById('score').innerText = puan;
                fb.innerText = "Aferin! âœ…"; fb.style.color = "#4caf50";
                document.getElementById('snd-success').play().catch(()=>{});
                el.classList.add('dogru');
                setTimeout(() => { el.classList.remove('dogru'); fb.innerText = ""; yeniSehirSor(); }, 800);
            } else {
                fb.innerText = "Tekrar Dene! âŒ"; fb.style.color = "#f44336";
                document.getElementById('snd-error').play().catch(()=>{});
                el.classList.add('yanlis');
                setTimeout(() => { el.classList.remove('yanlis'); fb.innerText = ""; }, 500);
            }
        }

        function oyunBitti() {
            const finalPuan = Math.max(puan, aktifOgrenci.puan || 0);
            db.collection("ogrenciler").doc(aktifOgrenci.id).update({ puan: finalPuan })
            .then(() => { alert("Oyun Bitti! PuanÄ±n: " + puan); location.reload(); });
        }

        window.onload = skorlariYukle;
    </script>
</body>
</html>
