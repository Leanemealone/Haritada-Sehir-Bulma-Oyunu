<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SÃ¼per Gezgin: TÃ¼rkiye Turu ğŸŒ</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

    <style>
        :root { --ana-renk: #4caf50; --turuncu: #f57c00; --mavi: #00bcd4; }
        body { margin: 0; font-family: 'Comic Sans MS', cursive; overflow: hidden; background: #e0f7fa; }

        /* Yan Ã‡evirme UyarÄ±sÄ± */
        #rotate-warning {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #2c3e50; color: white; z-index: 1000;
            flex-direction: column; justify-content: center; align-items: center; text-align: center;
        }

        @media screen and (orientation: portrait) {
            #rotate-warning { display: flex; }
            #game-area, #login-screen { display: none; }
        }

        /* GiriÅŸ EkranÄ± ve 20 KiÅŸilik Skor Tablosu */
        #login-screen { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; background: #ffeb3b; padding: 20px; }
        .login-card {
            background: white; padding: 25px; border-radius: 30px; 
            box-shadow: 0 15px 30px rgba(0,0,0,0.1); text-align: center; width: 380px; max-height: 90vh;
        }
        
        #leaderboard { 
            margin-top: 15px; background: #fff3e0; border-radius: 15px; padding: 10px; 
            max-height: 250px; overflow-y: auto; /* 20 kiÅŸi iÃ§in kaydÄ±rma eklendi */
        }
        .lb-row { display: flex; justify-content: space-between; padding: 8px 12px; border-bottom: 1px solid #ffe0b2; font-size: 0.9rem; }

        /* Oyun AlanÄ± */
        #game-area { display: none; flex-direction: column; height: 100vh; }
        #header { 
            height: 15%; background: var(--ana-renk); color: white; 
            display: flex; justify-content: space-around; align-items: center; font-size: 1.3rem;
        }
        #map-container { flex: 1; position: relative; display: flex; justify-content: center; align-items: center; }
        
        path { fill: #ffffff; stroke: #455a64; stroke-width: 0.6; cursor: pointer; }
        .dogru { fill: #4caf50 !important; }
        .yanlis { fill: #f44336 !important; }

        #feedback { position: absolute; top: 10%; left: 50%; transform: translateX(-50%); font-size: 2.2rem; font-weight: bold; z-index: 100; text-align: center;}
    </style>
</head>
<body>

    <div id="rotate-warning">
        <h1>ğŸ“± LÃ¼tfen telefonunuzu yan Ã§evirin!</h1>
        <p>Oyunun haritasÄ±nÄ± gÃ¶rmek iÃ§in bu gereklidir.</p>
    </div>

    <div id="login-screen">
        <div class="login-card">
            <h2 style="color: var(--turuncu); margin: 0;">SÃ¼per Gezgin ğŸŒ</h2>
            <p>Åifreni gir ve baÅŸla:</p>
            <input type="text" id="student-pass" placeholder="Åifren" style="padding:10px; border-radius:10px; border:2px solid orange;">
            <button onclick="loginCheck()" style="margin-top:10px;">GÄ°RÄ°Å YAP ğŸš€</button>
            
            <div id="leaderboard">
                <h3 style="margin: 5px 0; font-size: 1rem;">ğŸ† En YÃ¼ksek 20 Skor</h3>
                <div id="lb-list">YÃ¼kleniyor...</div>
            </div>
        </div>
    </div>

    <div id="game-area">
        <div id="header">
            <div>ğŸ“ <span id="target-city">---</span></div>
            <div>â±ï¸ <span id="timer">60</span></div>
            <div>ğŸ† <span id="score">0</span></div>
        </div>
        <div id="map-container">
            <div id="feedback"></div>
            <svg id="turkiye-svg" viewBox="0 0 1100 500" xmlns="http://www.w3.org/2000/svg"></svg>
        </div>
    </div>

    <audio id="snd-success" src="success.mp3"></audio>
    <audio id="snd-error" src="error.mp3"></audio>

    <script>
        // FIREBASE CONFIG (AynÄ± kalsÄ±n)
        const firebaseConfig = {
            apiKey: "AIzaSyDYEMEciQh-5wEYXgRChyX9PA9FCcehVew",
            authDomain: "haritada-sehir-bulma-oyunu.firebaseapp.com",
            projectId: "haritada-sehir-bulma-oyunu",
            storageBucket: "haritada-sehir-bulma-oyunu.firebasestorage.app",
            messagingSenderId: "212809269056",
            appId: "1:212809269056:web:d8c7e6e4e6c22e97c344a5"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        let aktifOgrenci = null;
        let puan = 0;
        let sure = 60;
        let sorulanSehir = "";
        let sehirListesi = [];

        // SKOR TABLOSU - Ä°LK 20 KÄ°ÅÄ°
        async function skorlariYukle() {
            const lbList = document.getElementById('lb-list');
            try {
                const snapshot = await db.collection("ogrenciler").orderBy("puan", "desc").limit(20).get();
                lbList.innerHTML = "";
                let sira = 1;
                snapshot.forEach(doc => {
                    const d = doc.data();
                    lbList.innerHTML += `<div class="lb-row"><span>${sira}. ${d.ad}</span> <b>${d.puan}</b></div>`;
                    sira++;
                });
            } catch (e) { console.error(e); }
        }

        async function haritayiHazirla() {
            try {
                const res = await fetch('tr.json');
                const data = await res.json();
                const svg = document.getElementById('turkiye-svg');
                data.forEach(sehir => {
                    sehirListesi.push(sehir.name);
                    const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
                    path.setAttribute("d", sehir.path);
                    path.setAttribute("id", sehir.name);
                    path.addEventListener('click', () => sehirTiklandi(path));
                    svg.appendChild(path);
                });
            } catch (err) { console.error("Harita yÃ¼klenemedi:", err); }
        }

        async function loginCheck() {
            const sifre = document.getElementById('student-pass').value;
            const doc = await db.collection("ogrenciler").doc(sifre).get();
            if (doc.exists) {
                aktifOgrenci = { id: sifre, ...doc.data() };
                document.getElementById('login-screen').style.display = 'none';
                document.getElementById('game-area').style.display = 'flex';
                oyunuBaslat();
            } else { alert("Åifre hatalÄ±!"); }
        }

        function oyunuBaslat() {
            yeniSehirSor();
            const sayac = setInterval(() => {
                sure--;
                document.getElementById('timer').innerText = sure;
                if (sure <= 0) { clearInterval(sayac); oyunBitti(); }
            }, 1000);
        }

        function yeniSehirSor() {
            sorulanSehir = sehirListesi[Math.floor(Math.random() * sehirListesi.length)];
            document.getElementById('target-city').innerText = sorulanSehir.toUpperCase();
        }

        function sehirTiklandi(el) {
            if (sure <= 0) return;
            const fb = document.getElementById('feedback');
            const sndSuccess = document.getElementById('snd-success');
            const sndError = document.getElementById('snd-error');
            
            if (el.id === sorulanSehir) {
                puan += 10;
                document.getElementById('score').innerText = puan;
                fb.innerText = "Aferin doÄŸru cevapladÄ±n! âœ…"; fb.style.color = "#4caf50";
                sndSuccess.play(); // BaÅŸarÄ± sesi
                el.classList.add('dogru');
                setTimeout(() => { el.classList.remove('dogru'); fb.innerText = ""; yeniSehirSor(); }, 800);
            } else {
                fb.innerText = "ÃœzgÃ¼nÃ¼m tekrar dene! âŒ"; fb.style.color = "#f44336";
                sndError.play(); // Hata sesi
                el.classList.add('yanlis');
                setTimeout(() => { el.classList.remove('yanlis'); fb.innerText = ""; }, 600);
            }
        }

        function oyunBitti() {
            const finalPuan = Math.max(puan, aktifOgrenci.puan || 0);
            db.collection("ogrenciler").doc(aktifOgrenci.id).update({ puan: finalPuan })
            .then(() => {
                alert("Oyun Bitti! Skorun: " + puan);
                location.reload();
            });
        }

        haritayiHazirla();
        skorlariYukle();
    </script>
</body>
</html>